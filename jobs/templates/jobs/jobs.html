{% extends 'base.html' %} {% block content %}
<div class="container mt-4">
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-4">üî• Job Board API</h1>
      <p class="lead">Production ready Django DRF</p>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col">
      <a href="/admin/" class="btn btn-success btn-lg me-2"> üõ†Ô∏è Admin Panel </a>
      <a href="/api/jobs/" class="btn btn-info btn-lg me-2"> üìä API Docs </a>
      <a href="#" class="btn btn-secondary btn-lg"> ‚ûï Add Job (soon) </a>
    </div>
  </div>

  <h3>üìã Available Jobs:</h3>
  <!-- JWT Login -->
  <div class="mb-4">
    <button class="btn btn-outline-primary" onclick="showLogin()">
      üîê API Login (admin/admin)
    </button>
  </div>

  <!-- Modal -->
  <div id="loginModal" class="modal" style="display: none">
    <div class="modal-content">
      <span onclick="hideLogin()" class="close">&times;</span>
      <h3>üîê Login</h3>
      <input
        id="username"
        type="text"
        class="form-control mb-2"
        value="admin"
        placeholder="Username"
      />
      <input
        id="password"
        type="password"
        class="form-control mb-2"
        value="admin"
        placeholder="Password"
      />
      <button onclick="apiLogin()" class="btn btn-primary w-100">Login</button>
      <div id="tokenResult" class="mt-3"></div>
    </div>
  </div>

  {% if jobs %}
  <div class="row">
    {% for job in jobs %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ job.title }}</h5>
          <h6 class="card-subtitle text-muted">{{ job.company.name }}</h6>
          <p class="card-text">{{ job.description|truncatewords:15 }}</p>
          <a href="#" class="btn btn-outline-primary btn-sm">View</a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info">
    <h4>üöÄ No jobs yet!</h4>
    <p>Add your first job via <a href="/admin/">Admin Panel</a></p>
  </div>
  {% endif %}
</div>

<style>
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: #0008;
  }
  .modal-content {
    background: #fff;
    margin: 15% auto;
    padding: 20px;
    width: 400px;
    border-radius: 8px;
  }
  .close {
    float: right;
    font-size: 28px;
    cursor: pointer;
  }
</style>

<script>
  function showLogin() {
    document.getElementById("loginModal").style.display = "block";
  }
  function hideLogin() {
    document.getElementById("loginModal").style.display = "none";
  }

  async function apiLogin() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    try {
      const res = await fetch("/api/auth/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password }),
      });
      const data = await res.json();

      if (data.access) {
        localStorage.setItem("token", data.access);
        document.getElementById("tokenResult").innerHTML =
          `<div class="alert alert-success">‚úÖ Token saved! <br><small>${data.access.slice(0, 30)}...</small></div>`;
      }
    } catch (err) {
      document.getElementById("tokenResult").innerHTML =
        '<div class="alert alert-danger">‚ùå Error</div>';
    }
  }
</script>

{% endblock %}
