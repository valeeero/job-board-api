{% extends 'base.html' %} {% block content %}
<div class="container mt-4">
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-4">ğŸ”¥ Job Board API</h1>
      <p class="lead">Production ready Django DRF</p>
    </div>
  </div>

  <div class="row mb-5">
    <div class="col">
      <a href="/admin/" class="btn btn-success btn-lg me-2">ğŸ› ï¸ Admin Panel</a>
      <a href="/api/docs/" class="btn btn-info btn-lg me-2">ğŸ“Š API Docs</a>
      <button onclick="showAddJob()" class="btn btn-secondary btn-lg">
        â• Add Job
      </button>

      <br />

      <!-- Auth controls -->
      <div class="btn-group me-2 mt-3 mb-4" role="group">
        <button onclick="loadMyApplications()" class="btn btn-success">
          ğŸ“‹ My Applications
          <span id="authStatus" class="badge bg-secondary ms-1">?</span>
        </button>
        <button
          onclick="logout()"
          class="btn btn-danger"
          id="logoutBtn"
          style="display: none"
        >
          ğŸšª Logout
        </button>
        <!-- JWT Login button -->
        <button id="loginBtn" class="btn btn-primary" onclick="showLogin()">
          ğŸ” Login
        </button>
      </div>
    </div>
  </div>

  <!-- My Applications section -->
  <div id="myJobsSection" class="mt-4 mb-3" style="display: none">
    <h3>ğŸ“‹ My Applications</h3>
    <div id="myJobsContent">Loading...</div>
  </div>

  <h3 class="mt-4">ğŸ“‹ Available Jobs:</h3>

  <!-- Login Modal -->
  <div id="loginModal" class="modal" style="display: none">
    <div class="modal-content">
      <span onclick="hideLogin()" class="close">&times;</span>
      <h3>ğŸ” Login</h3>
      <input
        id="username"
        type="text"
        class="form-control mb-2"
        placeholder="Username"
      />
      <input
        id="password"
        type="password"
        class="form-control mb-2"
        placeholder="Password"
      />
      <button onclick="apiLogin()" class="btn btn-primary w-100">Login</button>
      <div id="tokenResult" class="mt-3"></div>
    </div>
  </div>

  <!-- Jobs list -->
  {% if jobs %}
  <div class="row mt-4">
    {% for job in jobs %}
    <div class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ job.title }}</h5>
          <h6 class="card-subtitle text-muted">{{ job.company.name }}</h6>
          <p class="card-text">{{ job.description|truncatewords:15 }}</p>
          <a href="#" class="btn btn-outline-primary btn-sm">View</a>
          <button
            onclick="applyToJob({{ job.id }})"
            class="btn btn-primary btn-sm"
            id="apply-btn-{{ job.id }}"
          >
            Apply
          </button>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info mt-4">
    <h4>ğŸš€ No jobs yet!</h4>
    <p>Add your first job via <a href="/admin/">Admin Panel</a></p>
  </div>
  {% endif %}
</div>

<!-- Add Job Modal -->
<div id="addJobModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 600px">
    <span onclick="hideAddJob()" class="close">&times;</span>
    <h3>â• Add New Job</h3>
    <form id="addJobForm" class="row g-3">
      <div class="col-12">
        <label class="form-label">Job Title *</label>
        <input
          type="text"
          class="form-control"
          id="jobTitle"
          required
          placeholder="e.g. Senior Python Developer"
        />
      </div>

      <div class="col-12">
        <label class="form-label">Company *</label>
        <select class="form-select" id="jobCompany" required>
          <option value="">Select company...</option>
          <!-- Companies will be loaded dynamically -->
        </select>
      </div>

      <div class="col-12">
        <label class="form-label">Description *</label>
        <textarea
          class="form-control"
          id="jobDescription"
          rows="4"
          required
          placeholder="Job description..."
        ></textarea>
      </div>

      <div class="col-md-6">
        <label class="form-label">Min Salary ($)</label>
        <input
          type="number"
          class="form-control"
          id="jobSalaryMin"
          placeholder="50000"
        />
      </div>

      <div class="col-md-6">
        <label class="form-label">Max Salary ($)</label>
        <input
          type="number"
          class="form-control"
          id="jobSalaryMax"
          placeholder="80000"
        />
      </div>

      <div class="col-12">
        <label class="form-label">Location *</label>
        <input
          type="text"
          class="form-control"
          id="jobLocation"
          required
          placeholder="e.g. Remote, Kyiv"
        />
      </div>

      <div class="col-12">
        <label class="form-label">Skills (comma-separated) *</label>
        <input
          type="text"
          class="form-control"
          id="jobSkills"
          required
          placeholder="Python, Django, PostgreSQL"
        />
        <small class="text-muted">Separate skills with commas</small>
      </div>

      <div class="col-12">
        <button type="submit" class="btn btn-primary">âœ… Create Job</button>
        <button type="button" onclick="hideAddJob()" class="btn btn-secondary">
          Cancel
        </button>
        <span id="addJobStatus" class="ms-2"></span>
      </div>
    </form>
  </div>
</div>

<style>
  @keyframes slideInRight {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
  /* Toast Styles */
  .custom-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 9999;
    font-weight: 500;
    min-width: 250px;
    max-width: 400px;
    color: white;
    animation: slideInRight 0.3s ease-out;
  }

  .custom-toast.success {
    background: #28a745;
  }

  .custom-toast.error {
    background: #dc3545;
  }

  .custom-toast.warning {
    background: #ffc107;
  }

  .custom-toast.info {
    background: #17a2b8;
  }

  .custom-toast.hiding {
    animation: slideOutRight 0.3s ease-in;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: #0008;
  }
  .modal-content {
    background: #fff;
    margin: 15% auto;
    padding: 20px;
    width: 400px;
    border-radius: 8px;
  }
  .close {
    float: right;
    font-size: 28px;
    cursor: pointer;
  }
</style>
{% endblock %}
